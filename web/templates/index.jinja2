{% extends "base.jinja2" %}

{% block body %}

<style type="text/css">
    html, body { height: 100%; margin: 0; padding: 0; }
    #map { height: 100%; }
</style>

 <body>
 <nav style="background-color:#007E96; height:45px; border-radius:0px; border:0px;margin-bottom:0px" class="navbar navbar-default" >
</nav>
    <div id="map"></div>

    <script>
{#        mapMarkers = []#}
{#        usedMapMarkers = []#}
{#        map;#}
{#        function drawMarkers()#}
{#        {#}
{#            $.ajax({#}
{#                url: '/get_unique_runner_positions',#}
{#                success: function (data) {#}
{#                    var coordinates = JSON.parse(data);#}
{#                    for(var i = 0; i < coordinates.length; i++)#}
{#                    {#}
{#                        if(i < mapMarkers.length + usedMapMarkers.length)#}
{#                        {#}
{#                            var lowest = mapMarkers[0]#}
{#                            var lowestDistance =  coordinates[i].location_id - mapMarkers[0].location_id;#}
{#                            for(var j = 0; j < mapMarkers.length; j++)#}
{#                            {#}
{#                                var distance = coordinates[i].location_id - mapMarkers[j].location_id;#}
{#                                if( distance >= 0 && distance < lowestDistance)#}
{#                                {#}
{#                                    lowest = mapMarkers[0];#}
{#                                    lowest.location_id = coordinates[i].location_id;#}
{#                                }#}
{#                            }#}
{##}
{#                            var index = mapMarkers.indexOf(lowest);#}
{#                            if(index > -1) {#}
{#                                usedMapMarkers.push(mapMarkers[index])#}
{#                                mapMarkers.splice(index, 1);#}
{#                            }#}
{#                            if(lowestDistance > 0) {#}
{#                                var newLatLng = new google.maps.LatLng(coordinates[i].latitude, coordinates[i].longitude);#}
{#                                lowest.mapMarker.animateTo(newLatLng);#}
{#                            }#}
{##}
{#                        }#}
{#                        else#}
{#                        {#}
{##}
{#                            if(coordinates[i] != undefined) {#}
{#                                var runner =  new SlidingMarker({#}
{#                                    position: {lat: coordinates[i].latitude, lng: coordinates[i].longitude},#}
{#                                    map: map,#}
{#                                    duration: 1000,#}
{#                                    easing: "easeOutExpo",#}
{#                                    icon: {#}
{#                                        path: google.maps.SymbolPath.CIRCLE,#}
{#                                        scale: 2#}
{#                                    },#}
{#                                    flat: true,#}
{#                                    clickable: false,#}
{#                                });#}
{#                                mapMarkers.push({#}
{#                                    "mapMarker":runner,#}
{#                                    "location_id":coordinates[i].location_id#}
{#                                });#}
{#                            }#}
{#                        }#}
{#                    }#}
{#                    mapMarkers = mapMarkers.concat(usedMapMarkers);#}
{#                    usedMapMarkers = [];#}
{#                }#}
{#            });#}
{#        }#}
{##}
{#        function initMap() {#}
{#            map = new google.maps.Map(document.getElementById('map'), {#}
{#                zoom: 4,#}
{#                center: {lat: -33, lng: 151}#}
{#            });#}
{#        }#}
{#        setInterval(drawMarkers, 1000);#}

    </script>
    <script src="/static/js/jquery.easing.1.3.js"></script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDuNqpFE8a9dKuIINC91jdzd0IWJ1js-bw&callback=initMap"></script>
    <script src="/static/js/markerAnimate.js"></script>
    <script src="/static/js/SlidingMarker.min.js"></script>
</body>
{% endblock %}
